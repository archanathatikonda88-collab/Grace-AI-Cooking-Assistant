<!DOCTYPE html>
<html>
<head>
    <title>Instructions Format Test</title>
    <link rel="stylesheet" href="/static/styles.css?v=17">
    <style>
        body { padding: 20px; font-family: Arial, sans-serif; background: #f8f9fa; }
        .test-container { max-width: 800px; margin: 0 auto; background: white; padding: 24px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .test-button { padding: 12px 24px; background: #ff6b35; color: white; border: none; border-radius: 8px; cursor: pointer; margin: 10px 5px; }
        .test-result { margin: 15px 0; padding: 16px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #ff6b35; }
        h1 { color: #ff6b35; text-align: center; }
        h2 { color: #333; margin-top: 32px; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üç≥ Instructions Format Test</h1>
        
        <h2>üìã Current Instructions Format Preview</h2>
        <p>This shows how the instructions will appear with the new numbered list format:</p>
        
        <div class="instructions-section">
            <h3>Instructions</h3>
            <ol id="sample-instructions-list">
                <li><span class="instruction-number">1</span><span class="instruction-text">Heat <strong>2 tablespoons</strong> of oil in a large, heavy-bottomed pan over <strong>medium heat</strong> for <strong>1-2 minutes</strong> until the oil shimmers but doesn't smoke.</span></li>
                <li><span class="instruction-number">2</span><span class="instruction-text">Add the finely chopped onions and saut√© (cook while stirring) for <strong>8-10 minutes</strong>, stirring occasionally, until they turn golden brown (cook until golden) and translucent.</span></li>
                <li><span class="instruction-number">3</span><span class="instruction-text">Add minced garlic and grated ginger to the pan and cook for <strong>1-2 minutes</strong> until fragrant and the raw smell disappears completely.</span></li>
                <li><span class="instruction-number">4</span><span class="instruction-text">Sprinkle curry powder over the aromatics and stir continuously for <strong>30 seconds</strong> to toast the spices and release their flavors.</span></li>
                <li><span class="instruction-number">5</span><span class="instruction-text">Add chicken pieces and cook for <strong>5-7 minutes</strong>, turning occasionally, until all sides are coated with spice mixture and lightly browned.</span></li>
                <li><span class="instruction-number">6</span><span class="instruction-text">Pour in <strong>1 cup</strong> of water, bring to a gentle boil, then reduce heat to <strong>low heat</strong>, cover, and simmer (cook gently with small bubbles) for <strong>15-20 minutes</strong> until chicken is fully cooked through.</span></li>
                <li><span class="instruction-number">7</span><span class="instruction-text">Taste and season with salt and pepper as needed. Garnish with fresh cilantro leaves and serve immediately over steamed basmati rice.</span></li>
            </ol>
        </div>
        
        <h2>üß™ API Test</h2>
        <button class="test-button" onclick="testInstructions()">Test Live Recipe Instructions</button>
        <div id="api-result"></div>
        
        <h2>‚úÖ Enhancement Features</h2>
        <ul style="line-height: 1.8; color: #333;">
            <li>‚úÖ <strong>Clean Numbered List:</strong> Uses proper &lt;ol&gt;&lt;li&gt; HTML structure</li>
            <li>‚úÖ <strong>Detailed Steps:</strong> Each step includes specific timing and techniques</li>
            <li>‚úÖ <strong>Beginner-Friendly:</strong> Cooking terms explained in parentheses</li>
            <li>‚úÖ <strong>Highlighted Times:</strong> Cooking times and temperatures are emphasized</li>
            <li>‚úÖ <strong>Professional Styling:</strong> Clean spacing and readable typography</li>
            <li>‚úÖ <strong>Responsive Design:</strong> Works on all device sizes</li>
        </ul>
    </div>
    
    <script>
        async function testInstructions() {
            const resultDiv = document.getElementById('api-result');
            
            try {
                resultDiv.innerHTML = '<div class="test-result">Testing instructions format...</div>';
                
                // Get recipe suggestions first
                const suggestResp = await fetch('/suggest', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ ingredients: 'chicken', cuisine: 'indian', difficulty: 'easy' })
                });
                
                const suggestData = await suggestResp.json();
                
                if (suggestData.cards && suggestData.cards.length > 0) {
                    const recipeId = suggestData.cards[0].id;
                    
                    // Get recipe details
                    const detailResp = await fetch(`/api/recipe/${recipeId}`);
                    const detailData = await detailResp.json();
                    
                    if (detailData.instructions) {
                        // Test the instruction parsing logic (simplified version)
                        const instStr = detailData.instructions.trim();
                        let instructionsArray = [];
                        
                        if (instStr.match(/\\d+\\.\\s+[A-Z]/)) {
                            instructionsArray = instStr.split(/(?=\\d+\\.\\s+)/).filter(inst => inst.trim().length > 0);
                            instructionsArray = instructionsArray.map(inst => inst.replace(/^\\d+\\.\\s*/, '').trim()).filter(inst => inst.length > 0);
                        } else {
                            instructionsArray = [instStr];
                        }
                        
                        // Display results
                        let resultHTML = `
                            <div class="test-result">
                                <h4>‚úÖ Live Recipe Instructions Test Results:</h4>
                                <p><strong>Recipe:</strong> ${detailData.name}</p>
                                <p><strong>Instructions Found:</strong> ${instructionsArray.length} steps</p>
                                <p><strong>Original Format:</strong> ${typeof detailData.instructions}</p>
                                
                                <div class="instructions-section" style="margin-top: 16px; padding: 16px; background: white; border-radius: 8px;">
                                    <h4>Parsed Instructions:</h4>
                                    <ol>
                        `;
                        
                        instructionsArray.forEach((inst, index) => {
                            let cleanedInstruction = inst.trim()
                                .replace(/(\\d+[-‚Äì]\\d+\\s*(?:minutes?|mins?|seconds?|secs?|hours?))/gi, '<strong>$1</strong>')
                                .replace(/(\\d+[-‚Äì]\\d+\\s*¬∞?[CF]?|\\b(?:low|medium|high)\\s*heat\\b)/gi, '<strong>$1</strong>');
                            
                            resultHTML += `<li><span class="instruction-number">${index + 1}</span><span class="instruction-text">${cleanedInstruction}</span></li>`;
                        });
                        
                        resultHTML += `
                                    </ol>
                                </div>
                            </div>
                        `;
                        
                        resultDiv.innerHTML = resultHTML;
                    } else {
                        resultDiv.innerHTML = '<div class="test-result">‚ùå No instructions found in recipe data</div>';
                    }
                } else {
                    resultDiv.innerHTML = '<div class="test-result">‚ùå No recipe cards returned</div>';
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="test-result">‚ùå Error: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>